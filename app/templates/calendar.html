<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Family Calendar</title>
    <!-- Viewport optimized for tablet -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Refresh every 15 minutes (900 seconds) -->
    <meta http-equiv="refresh" content="900">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="{{ theme }}">

<div class="container">
    
    <!-- Header Row -->
    <div class="header-row">
        {% for col in columns %}
        <div class="header-cell {% if col.is_today %}today{% endif %}">
            <span class="day-name">{{ col.day_name }}</span>
            <span class="date-str">{{ col.date_str }}</span>
        </div>
        {% endfor %}
    </div>

    <!-- All-Day Events Grid -->
    {% if all_day_events %}
    <div class="all-day-grid" style="grid-template-columns: repeat({{ columns|length }}, 1fr);">
        {% for event in all_day_events %}
        <div class="all-day-card {% if event.is_left %}cont-left{% endif %} {% if event.is_right %}cont-right{% endif %}"
             style="grid-column: {{ event.col_start }} / span {{ event.col_span }}; grid-row: {{ event.row }};"
             onclick="showDetails(this)"
             data-summary="{{ event.summary }}"
             data-time="{{ event.time_str }}"
             data-date-range="{{ event.date_range }}"
             data-end-time=""
             data-description="{{ event.description }}"
             data-location="{{ event.location }}">
            {{ event.summary }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Timeline Body -->
    <div class="timeline-body">
        {% for col in columns %}
        <div class="day-column {% if col.is_today %}today{% endif %}">
            <div class="events-container">
                {% if col.events %}
                    {% for event in col.events %}
                    <div class="event-card" 
                         onclick="showDetails(this)"
                         data-summary="{{ event.summary }}"
                         data-time="{{ event.time }}"
                         data-end-time="{{ event.end_time }}"
                         data-description="{{ event.description }}"
                         data-location="{{ event.location }}">
                        <span class="event-time">{{ event.time }}</span>
                        <span class="event-summary">{{ event.summary }}</span>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="no-events">{{ no_events_text }}</div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

</div>

<!-- Details Modal Overlay -->
<div id="modal-overlay" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <span class="close-btn" onclick="closeDetails()">&times;</span>
        <h2 id="modal-summary"></h2>
        <div class="modal-meta">
            <span id="modal-time" class="modal-time"></span>
            <span id="modal-location" class="modal-location"></span>
        </div>
        <div id="modal-desc" class="modal-desc"></div>
    </div>
</div>

<script>
    function showDetails(element) {
        var summary = element.getAttribute('data-summary');
        var time = element.getAttribute('data-time');
        var endTime = element.getAttribute('data-end-time');
        var dateRange = element.getAttribute('data-date-range');
        var description = element.getAttribute('data-description');
        var location = element.getAttribute('data-location');

        document.getElementById('modal-summary').innerText = summary;
        
        var displayTime = "";
        if (dateRange) {
             displayTime = dateRange + " (" + time + ")";
        } else {
            displayTime = time;
            if (endTime) {
                displayTime += " - " + endTime;
            }
        }
        document.getElementById('modal-time').innerText = displayTime;

        document.getElementById('modal-desc').innerText = description;
        
        var locSpan = document.getElementById('modal-location');
        if (location) {
            locSpan.innerText = "üìç " + location;
            locSpan.style.display = 'inline';
        } else {
            locSpan.style.display = 'none';
        }

        document.getElementById('modal-overlay').style.display = 'block';
    }

    function closeDetails() {
        document.getElementById('modal-overlay').style.display = 'none';
    }
</script>

</body>
</html>
